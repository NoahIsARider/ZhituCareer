<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智途职业生涯规划 - 管理后台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --vivid-orange: #FF6600;
            --sunset-orange: #FF4500;
            --orange-light: rgba(255,102,0,0.08);
            --orange-border: rgba(255,102,0,0.15);
        }

        body {
            background-color: var(--orange-light);
        }

        .navbar {
            background: linear-gradient(90deg, var(--vivid-orange), var(--sunset-orange)) !important;
        }

        .admin-container {
            padding: 20px;
        }

        .section-title {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--orange-border);
            color: var(--vivid-orange);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-container {
            background: linear-gradient(145deg, rgba(255,255,255,0.95) 30%, rgba(255,102,0,0.05) 100%);
            border: 1px solid var(--orange-border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px var(--orange-border);
            transition: all 0.3s ease;
        }

        .data-container:hover {
            transform: translateY(-3px);
        }

        .btn-primary {
            background: var(--vivid-orange) !important;
            border: none !important;
        }

        .btn-primary:hover {
            background: var(--sunset-orange) !important;
        }

        .table {
            margin-bottom: 1rem;
        }

        .action-buttons {
            white-space: nowrap;
        }

        .modal-header {
            background: linear-gradient(90deg, var(--vivid-orange), var(--sunset-orange));
            color: white;
        }

        .modal-content {
            border: none;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">智途职业生涯规划 - 管理后台</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">退出登录</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container admin-container">
        <div class="row">
            <div class="col-12 mb-4">
                <div class="data-container">
                    <h3 class="section-title">
                        课程管理
                        <button class="btn btn-primary btn-sm" onclick="showAddCourseModal()"><i class="bi bi-plus-lg"></i> 添加课程</button>
                    </h3>
                    <div class="table-responsive">
                        <table class="table table-hover" id="courseTable">
                            <thead>
                                <tr>
                                    <th>课程名称</th>
                                    <th>描述</th>
                                    <th>类型</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="data-container">
                    <h3 class="section-title">
                        职位管理
                        <button class="btn btn-primary btn-sm" onclick="showAddJobModal()"><i class="bi bi-plus-lg"></i> 添加职位</button>
                    </h3>
                    <div class="table-responsive">
                        <table class="table table-hover" id="jobTable">
                            <thead>
                                <tr>
                                    <th>职位名称</th>
                                    <th>公司</th>
                                    <th>地点</th>
                                    <th>薪资范围</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Modal -->
    <div class="modal fade" id="courseModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="courseModalTitle">课程信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="courseForm">
                        <input type="hidden" id="courseIndex">
                        <div class="mb-3">
                            <label class="form-label">课程名称</label>
                            <input type="text" class="form-control" id="courseName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">课程提供方</label>
                            <input type="text" class="form-control" id="courseProvider" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">课程级别</label>
                            <select class="form-control" id="courseType" required>
                                <option value="Beginner">初级</option>
                                <option value="Intermediate">中级</option>
                                <option value="Advanced">高级</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">课程时长</label>
                            <input type="text" class="form-control" id="courseDuration" required placeholder="例如: 12 weeks">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">课程价格</label>
                            <input type="text" class="form-control" id="coursePrice" required placeholder="例如: $499">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">课程描述</label>
                            <textarea class="form-control" id="courseDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">技能标签</label>
                            <input type="text" class="form-control" id="courseSkills" required placeholder="用逗号分隔，例如: Python, Flask, Django">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">职业发展方向</label>
                            <input type="text" class="form-control" id="careerPaths" required placeholder="用逗号分隔，例如: Web Developer, Backend Developer">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveCourse()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Modal -->
    <div class="modal fade" id="jobModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="jobModalTitle">职位信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="jobForm">
                        <input type="hidden" id="jobIndex">
                        <div class="mb-3">
                            <label class="form-label">职位名称</label>
                            <input type="text" class="form-control" id="jobTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">公司</label>
                            <input type="text" class="form-control" id="jobCompany" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">地点</label>
                            <input type="text" class="form-control" id="jobLocation" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">薪资范围</label>
                            <input type="text" class="form-control" id="jobSalary" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">职位描述</label>
                            <textarea class="form-control" id="jobDescription" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveJob()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let courseData = [];
        let jobData = [];
        let courseModal;
        let jobModal;

        // Load and render course data
        function loadCourseData() {
            fetch('/api/courses')
                .then(response => response.json())
                .then(data => {
                    courseData = data.courses || [];
                    renderCourseTable();
                })
                .catch(error => console.error('Error loading course data:', error));
        }

        // Load and render job data
        function loadJobData() {
            fetch('/api/jobs')
                .then(response => response.json())
                .then(data => {
                    jobData = data.jobs || [];
                    renderJobTable();
                })
                .catch(error => console.error('Error loading job data:', error));
        }

        // Render course table
        function renderCourseTable() {
            const tbody = document.querySelector('#courseTable tbody');
            tbody.innerHTML = '';
            courseData.forEach((course, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${course.title}</td>
                    <td>${course.description}</td>
                    <td>${course.level}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editCourse(${index})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCourse(${index})"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Render job table
        function renderJobTable() {
            const tbody = document.querySelector('#jobTable tbody');
            tbody.innerHTML = '';
            jobData.forEach((job, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${job.title}</td>
                    <td>${job.company}</td>
                    <td>${job.location}</td>
                    <td>${job.salary}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-primary" onclick="editJob(${index})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="deleteJob(${index})"><i class="bi bi-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Course operations
        function showAddCourseModal() {
            document.getElementById('courseModalTitle').textContent = '添加课程';
            document.getElementById('courseForm').reset();
            document.getElementById('courseIndex').value = '';
            courseModal.show();
        }

        function editCourse(index) {
            const course = courseData[index];
            document.getElementById('courseModalTitle').textContent = '编辑课程';
            document.getElementById('courseIndex').value = index;
            document.getElementById('courseName').value = course.title;
            document.getElementById('courseDescription').value = course.description;
            document.getElementById('courseType').value = course.level;
            document.getElementById('courseProvider').value = course.provider;
            document.getElementById('courseDuration').value = course.duration;
            document.getElementById('coursePrice').value = course.price;
            document.getElementById('courseSkills').value = course.skills.join(', ');
            document.getElementById('careerPaths').value = course.career_paths.join(', ');
            courseModal.show();
        }

        function saveCourse() {
            const index = document.getElementById('courseIndex').value;
            const course = {
                id: index === '' ? String(Date.now()) : courseData[parseInt(index)].id,
                title: document.getElementById('courseName').value,
                description: document.getElementById('courseDescription').value,
                level: document.getElementById('courseType').value,
                provider: document.getElementById('courseProvider').value,
                duration: document.getElementById('courseDuration').value,
                price: document.getElementById('coursePrice').value,
                skills: document.getElementById('courseSkills').value.split(',').map(s => s.trim()),
                career_paths: document.getElementById('careerPaths').value.split(',').map(p => p.trim())
            };

            if (index === '') {
                courseData.push(course);
            } else {
                courseData[parseInt(index)] = course;
            }

            fetch('/api/courses', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ courses: courseData })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    courseModal.hide();
                    loadCourseData();
                } else {
                    alert('保存失败：' + result.error);
                }
            })
            .catch(error => alert('保存失败，请检查网络连接'));
        }

        function deleteCourse(index) {
            if (confirm('确定要删除这个课程吗？')) {
                courseData.splice(index, 1);
                fetch('/api/courses', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ courses: courseData })
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        loadCourseData();
                    } else {
                        alert('删除失败：' + result.error);
                    }
                })
                .catch(error => alert('删除失败，请检查网络连接'));
            }
        }

        // Job operations
        function showAddJobModal() {
            document.getElementById('jobModalTitle').textContent = '添加职位';
            document.getElementById('jobForm').reset();
            document.getElementById('jobIndex').value = '';
            jobModal.show();
        }

        function editJob(index) {
            const job = jobData[index];
            document.getElementById('jobModalTitle').textContent = '编辑职位';
            document.getElementById('jobIndex').value = index;
            document.getElementById('jobTitle').value = job.title;
            document.getElementById('jobCompany').value = job.company;
            document.getElementById('jobLocation').value = job.location;
            document.getElementById('jobSalary').value = job.salary;
            document.getElementById('jobDescription').value = job.description;
            jobModal.show();
        }

        function saveJob() {
            const index = document.getElementById('jobIndex').value;
            const job = {
                title: document.getElementById('jobTitle').value,
                company: document.getElementById('jobCompany').value,
                location: document.getElementById('jobLocation').value,
                salary: document.getElementById('jobSalary').value,
                description: document.getElementById('jobDescription').value
            };

            if (index === '') {
                jobData.push(job);
            } else {
                jobData[parseInt(index)] = job;
            }

            fetch('/api/jobs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ jobs: jobData })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    jobModal.hide();
                    loadJobData();
                } else {
                    alert('保存失败：' + result.error);
                }
            })
            .catch(error => alert('保存失败，请检查网络连接'));
        }

        function deleteJob(index) {
            if (confirm('确定要删除这个职位吗？')) {
                jobData.splice(index, 1);
                fetch('/api/jobs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ jobs: jobData })
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        loadJobData();
                    } else {
                        alert('删除失败：' + result.error);
                    }
                })
                .catch(error => alert('删除失败，请检查网络连接'));
            }
        }

        // Initialize data and modals when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Bootstrap modals
            courseModal = new bootstrap.Modal(document.getElementById('courseModal'));
            jobModal = new bootstrap.Modal(document.getElementById('jobModal'));
            
            // Load data
            loadCourseData();
            loadJobData();
        });
    </script>
</body>
</html>